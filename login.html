<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ROBLOX (Permission-based iframe)</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet" />
  <style>
    html, body {
      height: 100%;
      margin: 0;
      font-family: "Roboto", sans-serif;
      background-color: #1d1b1b;
      color: #fff;
    }

    nav {
      background-color: #c91673;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 24px;
      font-size: 18px;
      position: relative;
    }

    .nav-left { display:flex; align-items:center; gap:20px; }
    .nav-right { display:flex; align-items:center; gap:16px; }
    .logo img { height:42px; display:block; }
    nav a { color:#fff; text-decoration:none; font-size:16px; }
    .btn { border:1px solid #fff; padding:6px 12px; border-radius:6px; background:none; color:#fff; cursor:pointer; }
    .hamburger { display:none; flex-direction:column; gap:5px; cursor:pointer; }
    .hamburger span { width:24px; height:3px; background:#fff; border-radius:2px; }

    header { display:flex; flex-direction:column; align-items:center; justify-content:flex-start; height:100%; padding-top:60px; text-align:center; }

    .panel {
      background:#000; border-radius:8px; padding:28px 20px; max-width:420px; width:95%;
      box-shadow:0 6px 16px rgba(0,0,0,0.8); text-align:left;
    }

    .panel h1 { font-size:26px; font-weight:800; margin:0 0 12px; }
    .redirect-text { font-weight:bold; font-size:16px; color:#ddd; margin:0 0 20px; display:block; }

    .info-box { display:flex; align-items:flex-start; background:#2c2c2c; border-radius:6px; padding:10px 14px; margin:0 0 20px; width:100%; box-sizing:border-box; }
    .info-box img { width:22px; height:22px; margin-right:10px; margin-top:2px; flex-shrink:0; }
    .info-box p { font-size:15px; color:#ddd; margin:0; line-height:1.4; }

    .login-btn { margin-top:20px; background:#c91673; color:#fff; padding:12px 22px; border:none; border-radius:6px; font-size:16px; font-weight:600; cursor:pointer; width:100%; }
    .login-btn:hover { background:#a1125f; }

    .overlay { display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.65); z-index:999; }

    .fake-popup {
      display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%);
      width:90%; max-width:700px; height:600px; background:#fff; border-radius:8px;
      box-shadow:0 0 30px rgba(0,0,0,0.8); overflow:hidden; z-index:1000; border:1px solid #ccc;
      color:#333;
    }

    .window-bar { background:#e0e0e0; height:36px; display:flex; align-items:center; justify-content:space-between; padding:0 12px; font-size:14px; font-weight:bold; color:#333; border-bottom:1px solid #ccc; }
    .popup-close { font-size:20px; cursor:pointer; color:#666; }
    .url-bar { background:#f4f4f4; border:1px solid #ccc; margin:10px; padding:6px 10px; border-radius:6px; font-size:13px; font-family:monospace; color:#333; overflow:hidden; white-space:nowrap; text-overflow:ellipsis; }

    .popup-iframe { width:100%; height:calc(100% - 76px); border:none; background:#fff; }

    /* Permission modal inside the fake-popup */
    .consent-panel { padding:16px; display:flex; flex-direction:column; gap:12px; }
    .consent-text { font-size:14px; color:#222; }
    .consent-actions { display:flex; gap:10px; justify-content:flex-end; }
    .btn-allow { padding:8px 14px; border-radius:6px; border:none; cursor:pointer; background:#0b8457; color:#fff; font-weight:700; }
    .btn-deny { padding:8px 14px; border-radius:6px; border:1px solid #ccc; cursor:pointer; background:transparent; color:#333; }

    .error-banner {
      display:none; background:#fff1f1; color:#8a1c1c; padding:10px 12px; font-size:13px; border-top:1px solid #f1caca; text-align:left;
    }

    @media (max-width:768px) {
      .nav-left, .nav-right { display:none; }
      .hamburger { display:flex; }
    }
  </style>
</head>
<body>
  <nav>
    <div class="nav-left">
      <div class="logo"><img src="https://imgur.com/0ErnjPo.png" alt="RoVer Logo" /></div>
      <a href="#">Help</a>
      <a href="#">Team Members</a>
      <button class="btn">RoVer Plus</button>
    </div>
    <div class="nav-right">
      <button class="btn">Manage Servers</button>
      <a href="#" style="font-weight:700">Verification</a>
      <span class="username"></span>
    </div>
    <div class="hamburger" id="hamburger"><span></span><span></span><span></span></div>
  </nav>

  <div class="mobile-menu" id="mobileMenu">
    <a href="#">Help</a>
    <a href="#">Team Members</a>
    <button class="btn">RoVer Plus</button>
    <button class="btn">Manage Servers</button>
    <a href="#" style="font-weight:700">Verification</a>
    <span class="username"></span>
  </div>

  <header>
    <div class="panel" id="mockPanel">
      <h1>Link Roblox Account</h1>
      <span class="redirect-text">You will be redirected to Roblox.</span>
      <div class="info-box">
        <img src="https://img.icons8.com/ios-filled/50/1E90FF/info.png" alt="info" />
        <p>If the next page says:<br>
          <span style="color:#fff;">"You are not allowed to use this application"</span>, please read 
          <span style="color:#c91673;">this help article</span>.
        </p>
      </div>
      <button class="login-btn" id="loginBtn">Log in with Roblox</button>
    </div>
  </header>

  <div class="overlay" id="overlay"></div>

  <!-- Fake browser popup -->
  <div class="fake-popup" id="fakePopup" role="dialog" aria-modal="true">
    <div class="window-bar">
      ROBLOX
      <div class="popup-close" id="popupClose">&times;</div>
    </div>

    <!-- URL display -->
    <div class="url-bar" id="urlDisplay"> https://www.roblox.com/login</div>

    <!-- Consent / permission UI (shown before we actually set iframe.src) -->
    <div class="consent-panel" id="consentPanel">
      <div class="consent-text">
        This page is about to attempt to load external content (Roblox) inside an embedded window.
        For your safety, you must explicitly allow this. If the target website prevents embedding, the page may still fail to load.
      </div>
      <div style="display:flex; gap:8px; align-items:center;">
        <label style="font-size:13px; color:#444;">Target URL:</label>
        <input id="targetUrlInput" type="text" value="https://roblox.com/login"
               style="flex:1; padding:6px; border-radius:6px; border:1px solid #ccc; font-family:monospace;" />
      </div>
      <div class="consent-actions">
        <button class="btn-deny" id="denyBtn">Cancel</button>
        <button class="btn-allow" id="allowBtn">Allow and load</button>
      </div>
    </div>

    <!-- Error banner shown if iframe fails to load -->
    <div class="error-banner" id="errorBanner"></div>

    <!-- iframe is added but src left blank until permission granted -->
    <iframe class="popup-iframe" id="popupIframe" src="" sandbox=""></iframe>
  </div>

  <script>
    const loginBtn = document.getElementById("loginBtn");
    const hamburger = document.getElementById("hamburger");
    const mobileMenu = document.getElementById("mobileMenu");

    const fakePopup = document.getElementById("fakePopup");
    const popupClose = document.getElementById("popupClose");
    const overlay = document.getElementById("overlay");
    const iframe = document.getElementById("popupIframe");
    const urlDisplay = document.getElementById("urlDisplay");

    const consentPanel = document.getElementById("consentPanel");
    const allowBtn = document.getElementById("allowBtn");
    const denyBtn = document.getElementById("denyBtn");
    const targetUrlInput = document.getElementById("targetUrlInput");
    const errorBanner = document.getElementById("errorBanner");

    // open the fake popup and show consent UI
    loginBtn.addEventListener("click", () => {
      // show popup + overlay
      fakePopup.style.display = "block";
      overlay.style.display = "block";
      // reset previous state
      iframe.src = "";
      errorBanner.style.display = "none";
      consentPanel.style.display = "block";
      urlDisplay.textContent = " " + (new URL(targetUrlInput.value || "https://example.com")).hostname;
      // ensure iframe hidden until allowed (we keep it visible but empty)
    });

    popupClose.addEventListener("click", closePopup);
    denyBtn.addEventListener("click", closePopup);

    function closePopup() {
      fakePopup.style.display = "none";
      overlay.style.display = "none";
      iframe.src = "";
      errorBanner.style.display = "none";
    }

    // attempt to load the iframe only after explicit allow
    allowBtn.addEventListener("click", () => {
      const rawUrl = targetUrlInput.value.trim();
      if (!rawUrl) {
        showError("No URL provided.");
        return;
      }
      let finalUrl;
      try {
        // if user entered a relative or missing protocol, try to fix it
        finalUrl = new URL(rawUrl.includes("://") ? rawUrl : "https://" + rawUrl).toString();
      } catch (e) {
        showError("Invalid URL format.");
        return;
      }

      // update visible url text
      urlDisplay.textContent = " " + finalUrl;

      // hide consent UI to reveal iframe area
      consentPanel.style.display = "none";
      errorBanner.style.display = "none";

      // Clear previous src and set new one
      iframe.src = "";
      // Small timeout to allow UI update then set src (gives clearer UX)
      setTimeout(() => {
        iframe.src = finalUrl;
      }, 150);

      // Attempt to detect a successful load vs a block.
      // We'll use the iframe onload event as primary success signal.
      let loaded = false;
      const onLoadHandler = () => {
        loaded = true;
        // slight delay to allow visible content to render
        setTimeout(() => {
          // Hide any leftover error banner
          errorBanner.style.display = "none";
        }, 200);
        iframe.removeEventListener("load", onLoadHandler);
        clearTimeout(loadTimeout);
      };
      iframe.addEventListener("load", onLoadHandler);

      // If load doesn't occur within this timeout, show likely-blocked message.
      const loadTimeout = setTimeout(() => {
        if (!loaded) {
          // Show helpful message — browsers often block cross-origin embedding for security.
          showError(
            "The embedded page did not finish loading within a few seconds. " +
            "This usually means the target site prevents being embedded (X-Frame-Options / Content-Security-Policy). " +
            "Try opening the link in a new tab if you need to sign in."
          );
        }
      }, 6000); // 6 seconds

      // Also listen for iframe errors (rare for cross-origin blocks, but useful for local testing)
      iframe.addEventListener("error", () => {
        showError("Failed to load the iframe (network error or invalid URL).");
        clearTimeout(loadTimeout);
      });
    });

    function showError(message) {
      errorBanner.textContent = message;
      errorBanner.style.display = "block";
      // keep consent hidden so user sees iframe area with message
    }

    hamburger.addEventListener("click", () => {
      mobileMenu.classList.toggle("open");
    });
  </script>
</body>
</html>

